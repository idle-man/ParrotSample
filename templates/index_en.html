<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Sample for Parrot" />
    <meta name="description" content="Sample for Parrot" />
    <meta name="language" content="en" />
    <title>Sample for Parrot</title>
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/layoutit.css" rel="stylesheet">
    <link href="../static/css/default.css" rel="stylesheet">
    <link href="../static/css/base.css" rel="stylesheet">
    <link href="../static/css/list.css" rel="stylesheet">
    <link href="../static/css/content.css" rel="stylesheet">

    <script type="text/javascript" src="../static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="../static/js/jquery.htmlClean.js"></script>
    <script type="text/javascript" src="../static/js/scripts.min.js"></script>
</head>

<body>
    <div class="row clearfix">
        <div class="col-md-6 column"  style="height: 200px;">
            <div>
                <h3>Sample application for Parrot</h3>
                <br>
                <p>This website is only used for demo of Http requests.</p>
                <p>Data is saved in running memory, and would be reset after service restarted.</p>
            </div>
        </div>
        <div class="col-md-6 column"  style="height: 200px;">
            <div>
                <table>
                    <form role="form" class="nofollow" target="hiddenIframe">
                        <tr>
                            <td style="width: auto; text-align: center">
                                <div>
                                    <a href="zh_cn">切换到中文页面</a>
                                </div>
                            </td>
                            <td style="width: auto; text-align: center">
                                <div>
                                    <button type="button" class="btn btn-info" id="update-conf"
                                           onclick="updateConfig(conf_rate.value, conf_max_time.value, conf_min_time.value)">Update Variables
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: auto; text-align: center">
                                <label for="_rate">Exception Percent: </label>
                            </td>
                            <td style="width: auto; text-align: center">
                                <input
                                    type="number" style="text-align: center" class="form-control"
                                    id="_rate" name="conf_rate" value="{{ conf_rate }}"/>
                            </td>
                            <td>%</td>
                        </tr>
                        <tr>
                            <td style="width: auto; text-align: center">
                                <label for="_max_time">Max Duration: </label>
                            </td>
                            <td style="width: auto; text-align: center">
                                <input
                                    type="number" style="text-align: center" class="form-control"
                                    id="_max_time" name="conf_max_time" value="{{conf_max_time}}"/>
                            </td>
                            <td>ms</td>
                        </tr>
                        <tr>
                            <td style="width: auto; text-align: center">
                                <label for="_min_time">Min Duration: </label>
                            </td>
                            <td style="width: auto; text-align: center">
                                <input
                                    type="number" style="text-align: center" class="form-control"
                                    id="_min_time" name="conf_min_time" value="{{ conf_min_time }}"/>
                            </td>
                            <td>ms</td>
                        </tr>
                        <tr>

                        </tr>
                    </form>
                </table>
            </div>
        </div>
    </div>

    <iframe name="hiddenIframe" hidden></iframe>

    <div class="row clearfix">
        <div class="col-md-4 column" style="height: 360px;">
            <h3>User's Behavior</h3>
            <p>The default registered user is: sample / sample</p>
            <div class="tabbable" id="tabs-user">
                <ul class="nav nav-tabs">
                    <li>
                        <a rel="nofollow" href="#panel-register" data-toggle="tab">Register</a>
                    </li>
                    <li>
                        <a rel="nofollow" href="#panel-unregister" data-toggle="tab">UnRegister</a>
                    </li>
                    <li class="active">
                        <a rel="nofollow" href="#panel-logon" data-toggle="tab">Logon</a>
                    </li>
                    <li>
                        <a rel="nofollow" href="#panel-logout" data-toggle="tab">Logout</a>
                    </li>
                </ul>

                <br>

                <div class="tab-content">
                    <div class="tab-pane" id="panel-register">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <div class="form-group">
                                <label for="r_inputUsername">Username:</label>
                                <input type="text" class="form-control" id="r_inputUsername" name="r_username"/>
                            </div>
                            <div class="form-group">
                                <label for="r_inputPassword">Password:</label>
                                <input type="password" class="form-control" id="r_inputPassword" name="r_password"/>
                            </div>
                            <div>
                                <button type="button" class="btn btn-info" id="user-register"
                                        onclick="userRegister(r_username.value, r_password.value)">Submit</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="panel-unregister">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <br>
                            <div>
                                <button type="button" class="btn btn-info" id="user-unregister"
                                        onclick="userUnregister()">Submit</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane active" id="panel-logon">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <div class="form-group">
                                <label for="l_inputUsername">Username:</label>
                                <input type="text" class="form-control" id="l_inputUsername" name="l_username" value="sample"/>
                            </div>
                            <div class="form-group">
                                <label for="l_inputPassword">Password:</label>
                                <input type="password" class="form-control" id="l_inputPassword" name="l_password" value="sample" />
                            </div>
                            <div>
                                 <button type="button" class="btn btn-info" id="user-logon"
                                         onclick="userLogon(l_username.value, l_password.value)">Logon</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="panel-logout">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <br>
                            <div>
                                 <button type="button" class="btn btn-info" id="user-logout"
                                         onclick="userLogout()">Logout</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4 column" style="height: 360px;">
            <h3>Display Area</h3>
            <p>The request and response information of the interface will be presented here.</p>
            <blockquote style="overflow: auto; height: 250px">
                <pre style="height: auto; " id="api-response">

                </pre>
            </blockquote>

        </div>

        <div class="col-md-4 column" style="height: 360px;">
            <h3>User's Hobbies</h3>
            <p>Please make sure you have logged in before any operation.</p>
            <div class="tabbable" id="tabs-hobby">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a rel="nofollow" href="#panel-list" data-toggle="tab">List</a>
                    </li>
                    <li>
                        <a rel="nofollow" href="#panel-detail" data-toggle="tab">Detail</a>
                    </li>
                    <li>
                        <a rel="nofollow" href="#panel-add" data-toggle="tab">Add</a>
                    </li>
                    <li>
                        <a rel="nofollow" href="#panel-remove" data-toggle="tab">Remove</a>
                    </li>
                    <li>
                        <a rel="nofollow" href="#panel-suggest" data-toggle="tab">Suggest</a>
                    </li>
                </ul>
                <br>
                <div class="tab-content">
                    <div class="tab-pane active" id="panel-list">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <div class="form-group">
                                 <p></p>
                            </div>
                            <div>
                                 <button type="button" class="btn btn-info" id="hobby-list"
                                         onclick="hobbyList()">Search</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="panel-detail">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <div class="form-group">
                                <label for="hobbyName0">Hobby Name:</label>
                                <input type="text" class="form-control" id="hobbyName0" name="hobby_name0" value="reading" />
                            </div>
                            <div>
                                 <button type="button" class="btn btn-info" id="hobby-detail"
                                         onclick="hobbyDetail(hobby_name0.value)">Search</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="panel-add">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <div class="form-group">
                                <label for="hobbyName1">Hobby Name:</label>
                                <input type="text" class="form-control" id="hobbyName1" name="hobby_name1" value="reading"/>
                            </div>
                            <div class="form-group">
                                <label for="hobbyFrequency1">Frequency:</label>
                                <input type="text" class="form-control" id="hobbyFrequency1" name="hobby_frequency1" value="1 book per month"/>
                            </div>
                            <div>
                                 <button type="button" class="btn btn-info" id="hobby-add"
                                         onclick="hobbyAdd(hobby_name1.value, hobby_frequency1.value)">Add</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="panel-remove">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <div class="form-group">
                                <label for="hobbyName2">Hobby Name:</label>
                                <input type="text" class="form-control" id="hobbyName2" name="hobby_name2" />
                            </div>
                            <div>
                                 <button type="button" class="btn btn-info" id="hobby-remove"
                                         onclick="hobbyRemove(hobby_name2.value)">Remove</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="panel-suggest">
                        <form role="form" class="nofollow" target="hiddenIframe">
                            <br>
                            <div>
                                 <button type="button" class="btn btn-info" id="hobby-suggest"
                                         onclick="hobbySuggest()">Give a try!</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="footer">
        <div class="copyRight">
            Copyright ©2018-2028 <a>Sample Project by Idleman</a>
        </div>
    </div>

    <script type="text/javascript">
        // var base_url = window.location.href;
        var base_url = "{{base_url}}";

        function updateConfig(rate, max_time, min_time) {
            var this_url = base_url + 'update_config'
            $.ajax({
                url: this_url,
                data: {'rate': rate, 'max': max_time, 'min': min_time},
                type: 'POST',
                success: function (response) {
                    displayConfig(response);
                }
            });
        }

        function userRegister(username, password) {
            var this_url = base_url + 'register';
            var this_desc = "Register a new user";
            $.ajax({
                url: this_url,
                data: {'username': username, 'password': password},
                type: 'POST',
                success: function (response, status, xhr) {
                    displayResponse("POST " + this_url, this_desc, xhr);
                }
            });
        }

        function userUnregister() {
            var this_url = base_url + 'unregister';
            var this_desc = "Unregister current user";
            $.ajax({
                url: this_url,
                data: {},
                type: 'POST',
                beforeSend: function(XMLHTTPRequest){
                    XMLHTTPRequest.setRequestHeader("token", getToken());
                },
                success: function (response, status, xhr) {
                    displayResponse("POST " + this_url, this_desc, xhr);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function userLogon(username, password) {
            var this_url = base_url + 'logon';
            var this_desc = "Logon";
            $.ajax({
                url: this_url,
                data: {'username': username, 'password': password},
                type: 'POST',
                success: function (response, status, xhr) {
                    displayResponse("POST " + this_url, this_desc, xhr);
                }
            });
        }

        function userLogout() {
            var this_url = base_url + 'logout';
            var this_desc = "Logout";
            $.ajax({
                url: this_url,
                data: {},
                type: 'POST',
                beforeSend: function(XMLHTTPRequest){
                    XMLHTTPRequest.setRequestHeader("token", getToken());
                },
                success: function (response, status, xhr) {
                    displayResponse("POST " + this_url, this_desc, xhr);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function hobbyList() {
            var this_url = base_url + 'hobby_list';
            var this_desc = "My Hobbies";
            $.ajax({
                url: this_url,
                data: {},
                type: 'GET',
                beforeSend: function(XMLHTTPRequest){
                    XMLHTTPRequest.setRequestHeader("token", getToken());
                },
                success: function (response, status, xhr) {
                    displayResponse("GET " + this_url, this_desc, xhr);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function hobbyDetail(name) {
            var this_url = base_url + 'hobby_detail';
            var this_desc = "Detail of a hobby";
            $.ajax({
                url: this_url,
                data: {'name': name},
                type: 'GET',
                beforeSend: function(XMLHTTPRequest){
                    XMLHTTPRequest.setRequestHeader("token", getToken());
                },
                success: function (response, status, xhr) {
                    displayResponse("GET " + this_url, this_desc, xhr);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function hobbyAdd(name, frequency) {
            var this_url = base_url + 'hobby_add';
            var this_desc = "Add a hobby";
            $.ajax({
                url: this_url,
                data: {'name': name, 'frequency': frequency},
                type: 'POST',
                beforeSend: function(XMLHTTPRequest){
                    XMLHTTPRequest.setRequestHeader("token", getToken());
                },
                success: function (response, status, xhr) {
                    displayResponse("POST " + this_url, this_desc, xhr);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function hobbyRemove(name) {
            var this_url = base_url + 'hobby_remove';
            var this_desc = "Remove a hobby";
            $.ajax({
                url: this_url,
                data: {'name': name},
                type: 'POST',
                beforeSend: function(XMLHTTPRequest){
                    XMLHTTPRequest.setRequestHeader("token", getToken());
                },
                success: function (response, status, xhr) {
                    displayResponse("POST " + this_url, this_desc, xhr);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function hobbySuggest() {
            var this_url = base_url + 'hobby_suggest';
            var this_desc = "A random suggestion";

            $.ajax({
                url: this_url,
                data: {'today': getToday()},
                type: 'GET',
                beforeSend: function(XMLHTTPRequest){
                    XMLHTTPRequest.setRequestHeader("token", getToken());
                },
                success: function (response, status, xhr) {
                    displayResponse("GET " + this_url, this_desc, xhr);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }

        function displayResponse(url, desc, xhr) {
            $("#api-response").empty();
            $("#api-response").append(desc + "\n\n");
            $("#api-response").append("Request: " + url + "\n\n");
            $("#api-response").append("Status Code: " + xhr.status + "\n\n");
            $("#api-response").append("Response Text:\n" + xhr.responseText + "\n");
            $("#api-response").append("Response Headers:\n" + xhr.getAllResponseHeaders());
        }

        function displayConfig(response) {
            var conf = response.config;
            $("#_rate").empty();
            $("#_max_time").empty();
            $("#_min_time").empty();
            $("#_rate").append(conf["EXCEPTION_PERCENT"]);
            $("#_max_time").append(conf["DURATION_MAX"]);
            $("#_min_time").append(conf["DURATION_MIN"]);
        }

        function doRefresh() {
            location.reload();
        }

        function getToday() {
            var date = new Date();
            var nowMonth = date.getMonth() + 1;
            var nowDate = date.getDate();
            var separator = "-";

            if (nowMonth >= 1 && nowMonth <= 9) {
               nowMonth = "0" + nowMonth;
            }

            if (nowDate >= 0 && nowDate <= 9) {
               nowDate = "0" + nowDate;
            }

            return date.getFullYear() + separator + nowMonth + separator + nowDate;
        }
        
        function getToken() {
            var cookies = document.cookie.split(';');
            for(var i=0; i < cookies.length; i++){
                var _cookie = cookies[i]
                var item = _cookie.split('=');
                if (item[0].trim() == 'token') {
                    return item[1]
                }
            }
            return ""
        }
    </script>
</body>
</html>